<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checklist Mariage</title>
  <style>
    :root {
      --primary: #086972;
      --secondary: #a7ffeb;
      --success: #00b894;
      --danger: #ff7675;
      --bg: #f4f7f8;
      --card: rgba(255, 255, 255, 0.9); /* Le 0.9 signifie 90% d'opacit√© (un peu transparent) */
    }

    body { 
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
      background-color: var(--bg);
      color: #2d3436;
      max-width: 600px; 
      margin: auto; 
      padding: 20px;
    }

    h1 { text-align: center; color: var(--primary); font-weight: 800; margin-bottom: 30px; }

    #add { 
      background: var(--card);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    input[type="text"] { 
      padding: 12px; 
      border: 1px solid #dfe6e9; 
      border-radius: 8px; 
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus { border-color: var(--primary); }

    button#addBtn { 
      background: var(--primary); 
      color: white; 
      border: none; 
      padding: 12px; 
      border-radius: 8px; 
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
    }

    button#addBtn:active { transform: scale(0.98); }

    /* Liste des t√¢ches */
    .item { 
      background: var(--card);
      margin-bottom: 12px;
      padding: 15px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      transition: all 0.3s ease;
    }

    .item.done { opacity: 0.6; background: #f1f2f6; }

    /* Grande Case √† cocher personnalis√©e */
    .checkbox-container {
      position: relative;
      width: 30px;
      height: 30px;
      cursor: pointer;
    }

    .checkbox-container input { display: none; }

    .checkmark {
      position: absolute;
      top: 0; left: 0;
      height: 30px; width: 30px;
      background-color: #eee;
      border-radius: 6px;
      transition: 0.3s;
      border: 1.5px solid #086972;
    }

    .checkbox-container input:checked ~ .checkmark { background-color: var(--success); }

    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
      left: 10px;
      top: 5px;
      width: 6px;
      height: 12px;
      border: solid white;
      border-width: 0 3px 3px 0;
      transform: rotate(45deg);
    }

    .checkbox-container input:checked ~ .checkmark:after { display: block; }

    /* Infos de la t√¢che */
    .item-content { flex: 1; }
    .item-title { font-weight: 600; display: block; margin-bottom: 4px; font-size: 16px; }
    .item-details { font-size: 12px; color: #636e72; display: flex; gap: 8px; flex-wrap: wrap; }
    .badge { background: #f1f2f6; padding: 2px 8px; border-radius: 4px; }

    .delete-btn { 
      background: none; border: none; color: var(--danger); 
      font-size: 20px; cursor: pointer; padding: 5px;
    }

    /* Couleur pour la Veille (Bleu doux) */
    .item.veille { border-left: 15px solid #d982b5; }

    /* Couleur pour le Jour J (Orange/Jaune pour l'alerte) */
    .item.jourj { border-left: 15px solid #fdcb6e; }

    /* On ajuste un peu la carte pour que le bord color√© soit joli */
    .item { border-left: 8px solid transparent; }

    .badge { 
      cursor: pointer; 
      transition: background 0.2s;
      user-select: none; /* √âvite de s√©lectionner le texte en cliquant vite */
    }

    .badge:hover {
      background: #dfe6e9; /* Devient un peu plus fonc√© au survol */
    }

    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
  .tab-btn { 
    flex: 1; padding: 10px; border: none; border-radius: 8px; 
    background: #dfe6e9; cursor: pointer; font-weight: bold; color: #636e72;
  }
  .tab-btn.active { background: var(--primary); color: white; }

  .timeline-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
  .timeline-list { 
    list-style: none; 
    padding: 0; 
    border-left: 2px dashed #dfe6e9; 
    margin-left: 75px; /* On se place juste apr√®s la fin des 70px de l'heure */
    padding-left: 15px; 
  }

  .timeline-list li { 
    display: flex;             /* Aligne l'heure et le texte sur la m√™me ligne */
    align-items: flex-start;   /* Aligne le texte en haut si plusieurs lignes */
    padding: 15px 0; 
    border-bottom: 1px solid #eee; 
  }

  .time { 
    color: var(--primary); 
    font-weight: 800; 
    font-size: 16px;
    width: 70px;               /* Largeur fixe pour la colonne des heures */
    flex-shrink: 0;            /* Emp√™che l'heure de r√©tr√©cir */
  }

  .desc { 
    font-size: 15px; 
    line-height: 1.4;          /* Espace un peu les lignes pour la lecture */
    color: #2d3436;
  }

  .desc-container {
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .note {
    font-size: 13px;       /* Plus petit que le texte principal */
    font-style: italic;    /* En italique */
    color: #636e72;        /* Un gris plus doux */
    margin-top: 4px;       /* Un petit espace avec la ligne du dessus */
  }

  </style>
</head>
<body>

  <h1>Checklist Mariage 25/07</h1>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('checklist')">üìã Checklist</button>
    <button class="tab-btn" onclick="showTab('timeline')">üïí D√©roul√© Jour J</button>
  </div>

  <div id="add">
    <input type="text" id="newItem" placeholder="Action (ex: R√©server le traiteur...)">
    <div style="display: flex; gap: 8px;">
      <input type="text" id="newPlace" placeholder="Lieu" style="flex: 1;">
      <input type="text" id="newOwner" placeholder="Responsable" style="flex: 1;">
    </div>

    <div style="display: flex; justify-content: space-around; padding: 10px; background: #f1f2f6; border-radius: 8px; margin-top: 5px;">
      <label><input type="radio" name="moment" value="veille" checked> üåô Veille</label>
      <label><input type="radio" name="moment" value="jourj"> üöÄ Jour J</label>
    </div>

    <button id="addBtn" onclick="addItem()">Ajouter √† la liste</button>
  </div>

  <div style="margin-bottom: 20px;">
  <input type="text" id="filterInput" onkeyup="filterTasks()" placeholder="Filtrer par responsable ou lieu..." 
         style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #086972; box-sizing: border-box;">
  </div>

  <div id="list"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { 
      getDatabase, ref, onValue, push, set, remove 
    } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

    // TA CONFIGURATION (Gard√©e de ton code pr√©c√©dent)
    const firebaseConfig = {
      apiKey: "AIzaSyCbpc_k-kDC5pN6A2MLmt_6jCJ0mnM_AC4",
      authDomain: "checklist-mariage.firebaseapp.com",
      databaseURL: "https://checklist-mariage-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "checklist-mariage",
      storageBucket: "checklist-mariage.firebasestorage.app",
      messagingSenderId: "436777851923",
      appId: "1:436777851923:web:341755f72d59a6dff9b3e6",
      measurementId: "G-T096M0YK86"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    
    const listDiv = document.getElementById("list");

    function render(items) {
      listDiv.innerHTML = "";
      for (const id in items) {
        const item = items[id];

        const row = document.createElement("div");
        // On ajoute la classe veille ou jourj en fonction de la donn√©e
        row.className = `item ${item.done ? 'done' : ''} ${item.moment || ''}`;

        row.innerHTML = `
          <label class="checkbox-container">
            <input type="checkbox" ${item.done ? 'checked' : ''} onchange="toggleItem('${id}', ${item.done}, '${item.text}', '${item.place || ''}', '${item.owner || ''}')">
            <span class="checkmark"></span>
          </label>
          <div class="item-content">
            <span class="item-title" onclick="editField('${id}', 'text', '${item.text.replace(/'/g, "\\'")}')" style="cursor: pointer;">
  ${item.text}
            </span>
            <div class="item-details">
  		<span class="badge" onclick="editField('${id}', 'place', '${item.place || ''}')">
                 üìç ${item.place || 'Ajouter lieu'}
                </span>
                <span class="badge" onclick="editField('${id}', 'owner', '${item.owner || ''}')">
                 üë§ ${item.owner || 'Ajouter responsable'}
  	        </span>
 	        <span class="badge">${item.moment === 'jourj' ? 'üöÄ Jour J' : 'üåô Veille'}</span>
	    </div>
          </div>
          <button class="delete-btn" onclick="deleteItem('${id}', '${item.text}')">&times;</button>
        `;
        listDiv.appendChild(row);
      }
    }

    // Fonctions globales pour Firebase
    window.toggleItem = (id, currentStatus, text, place, owner) => {
      set(ref(db, "items/" + id), {
        text: text,
        place: place,
        owner: owner,
        done: !currentStatus
      });
    };

    window.deleteItem = (id, text) => {
      if (confirm(`Supprimer "${text}" ?`)) remove(ref(db, "items/" + id));
    };

    window.addItem = function () {
      const text = document.getElementById("newItem").value.trim();
      if (!text) return;
      const place = document.getElementById("newPlace").value.trim();
      const owner = document.getElementById("newOwner").value.trim();
      const moment = document.querySelector('input[name="moment"]:checked').value;
    // Ajoute ensuite "moment" dans ton push vers Firebase :
      push(ref(db, "items"), { text, place, owner, moment, done: false });
      

      // Reset des champs
      document.getElementById("newItem").value = "";
      document.getElementById("newPlace").value = "";
      document.getElementById("newOwner").value = "";
    };

    onValue(ref(db, "items"), snap => {
      const data = snap.val() || {};
      // On transforme l'objet en tableau pour pouvoir le trier
      const sortedItems = Object.entries(data).sort((a, b) => a[1].done - b[1].done);
  
      // On transforme le tableau tri√© en un objet pour ta fonction render
      const finalObj = Object.fromEntries(sortedItems);
      render(finalObj);
    });
  
  window.filterTasks = function() {
    const query = document.getElementById("filterInput").value.toLowerCase();
    const items = document.querySelectorAll(".item");

    items.forEach(item => {
      // On r√©cup√®re tout le texte √† l'int√©rieur de la carte (titre, lieu, responsable)
      const text = item.innerText.toLowerCase();
    
      // Si la recherche est vide ou si le texte contient le mot tap√©, on affiche
      if (text.includes(query)) {
        item.style.display = "flex";
      } else {
        item.style.display = "none"; // Sinon on cache
      }
    });
  };
  window.editField = function(id, field, oldValue) {
    const label = field === 'place' ? 'le lieu' : 'le responsable';
    const newValue = prompt(`Modifier ${label} :`, oldValue);
  
    // Si l'utilisateur clique sur Annuler, on ne fait rien
    if (newValue === null) return; 
  
    // On met √† jour uniquement le champ concern√© dans Firebase
    const itemRef = ref(db, `items/${id}/${field}`);
    set(itemRef, newValue);
  };

  window.showTab = function(tabName) {
    const isChecklist = tabName === 'checklist';
  
    // Affiche ou cache les sections
    document.getElementById('add').style.display = isChecklist ? 'flex' : 'none';
    document.getElementById('filterInput').style.display = isChecklist ? 'block' : 'none';
    document.getElementById('list').style.display = isChecklist ? 'block' : 'none';
    document.getElementById('timeline-section').style.display = isChecklist ? 'none' : 'block';

    // G√®re l'apparence des boutons
    const btns = document.querySelectorAll('.tab-btn');
    btns[0].classList.toggle('active', isChecklist);
    btns[1].classList.toggle('active', !isChecklist);
  };

  </script>

  <div id="timeline-section" style="display: none;">
    <div class="timeline-card">
      <h3>üïí Planning de la journ√©e</h3>
      <ul class="timeline-list">
        <li>
          <span class="time">13:30</span>
	  <div class="desc-container">
	    <span class="desc">Coiffure et Maquillage</span>
            <span class="note">Larressingle</span>
	  </div>
        </li>
        <li>
          <span class="time">15:30</span>
	  <div class="desc-container">
            <span class="desc">Habillage, arriv√©e des Dem. d'honneur et t√©moins √† la maison</span>
	    <span class="note">Larressingle</span>
	  </div>
        </li>
        <li>
	  <span class="time">16:00</span>
	  <div class="desc-container">
	    <span class="desc">C√©r√©monie Civile</span>
 	    <span class="note">Larressingle, arriv√©e de la mari√©e vers 16h15</span>
          </div>
        </li>
        <li>
          <span class="time">17:00</span>
	  <div class="desc-container">
	    <span class="desc">Photos des mari√©s au ch√¢teau de Larressingle.<br><strong>üìû Contact photographe :</strong> David - 06 84 36 67 12</span>
 	    <span class="note">Les invit√©s rejoignent la Palombi√®re d'Henri √† Moncrabeau</span>
          </div>
        </li>
        <li>
          <span class="time">18:00</span>
	  <div class="desc-container">
	    <span class="desc">C√©r√©monie La√Øque</span>
 	    <span class="note">Animation par Tony, discours des t√©moins et des parents, √©change des alliances et voeux</span>
          </div>
        </li>
        <li>
          <span class="time">18:45</span>
	  <div class="desc-container">
	    <span class="desc">Vin d'honneur.<br><strong>üìû Contact saxophoniste :</strong> Pierre - 07 80 23 94 09</span>
 	    <span class="note">Cocktail & bouch√©es (4 serveurs)</span>
          </div>
        </li>
        <li>
          <span class="time">21:00</span>
	  <div class="desc-container">
	    <span class="desc">D√Æner.<br><strong>üìû Contact traiteur :</strong> M. Ducousseau - 06 87 12 94 68</span>
 	    <span class="note">Plat + Assiette de fromage, Discours des Dem. d'honneur et jeux</span>
          </div>
        </li>
        <li>
          <span class="time">22:30</span>
	  <div class="desc-container">
	    <span class="desc">Ouvertre de bal</span>
 	    <span class="note">Valse papa et Adil</span>
          </div>
        </li>
        <li>
          <span class="time">22:45</span>
	  <div class="desc-container">
	    <span class="desc">Pi√®ces-mont√©e.<br><strong>üìû Contact P√¢tisserie :</strong> C. Garnier - 05 62 28 11 33</span>
 	    <span class="note">Livraison par le patissier directement</span>
          </div>
        </li>
        <li>
          <span class="time">23:15</span>
	  <div class="desc-container">
	    <span class="desc">Soir√©e</span>
 	    <span class="note">Surprise des Dem. d'honneur</span>
          </div>
        </li>
      </ul>
    </div>
  </div>

</body>
</html>