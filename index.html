<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Budget Mariage - Clean Design</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #e0e0e0;
            --highlight: #4caf50;
            --input-bg: #3d3d3d;
            --unpaid: #ff5252;
            --adil-color: #2196F3;
            --hanalei-color: #E91E63;
            --parents-color: #FF9800;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 220px; }
        
        /* --- SUPPRESSION DES FLÈCHES (SPINNERS) --- */
        /* Pour Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Pour Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        .side-tabs { position: fixed; left: 0; top: 25%; display: flex; flex-direction: column; gap: 12px; z-index: 1000; }
        .tab { width: 40px; height: 50px; border-radius: 0 10px 10px 0; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; box-shadow: 4px 0 10px rgba(0,0,0,0.3); }
        .tab-a { background: var(--adil-color); }
        .tab-h { background: var(--hanalei-color); }
        .tab-p { background: var(--parents-color); }

        #detailsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; backdrop-filter: blur(5px); align-items: center; justify-content: center; }
        .modal-content { background: var(--card-bg); width: 85%; max-width: 320px; padding: 25px; border-radius: 20px; border: 1px solid #444; text-align: center; }
        .modal-active { display: flex !important; }

        .container { max-width: 500px; margin: 0 auto; }
        .card { background: var(--card-bg); border-radius: 15px; margin-bottom: 20px; padding: 15px; border: 1px solid #3d3d3d; }
        .card-title { font-weight: bold; font-size: 1rem; margin-bottom: 12px; text-align: center; color: #fff; text-transform: uppercase; }
        
        .total-wrapper { text-align: center; margin-bottom: 15px; display: flex; justify-content: center; }
        .input-cout { background: transparent; border: none; border-bottom: 2px solid var(--highlight); font-weight: bold; font-size: 1.6rem; color: var(--highlight); width: 160px; text-align: center; outline: none; }

        .payeurs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .payeur-box { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .payeur-box label { font-size: 0.7rem; color: #aaa; text-transform: capitalize; }
        .payeur-box input[type="number"] { width: 100%; box-sizing: border-box; padding: 10px 5px; border-radius: 8px; border: none; background: var(--input-bg); color: white; font-size: 1rem; text-align: center; outline: none; }
        .pay-check { width: 22px; height: 22px; cursor: pointer; accent-color: var(--highlight); }

        .is-paid-field { background: rgba(74, 175, 80, 0.2) !important; border: 1px solid var(--highlight) !important; }
        .comment-input { width: 100%; box-sizing: border-box; background: rgba(0,0,0,0.2); border: 1px solid #444; border-radius: 6px; color: #bbb; font-size: 0.8rem; font-style: italic; margin-top: 15px; padding: 8px; }

        .sticky-footer { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px 20px; z-index: 100; border-top: 1px solid #333; }
        .progress-container { height: 6px; background: #333; border-radius: 3px; margin-bottom: 10px; overflow: hidden; }
        #progressBar { height: 100%; background: var(--highlight); width: 0%; transition: 0.5s; }
        .btn-save { width: 100%; padding: 15px; background: var(--highlight); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="side-tabs">
        <div class="tab tab-a" onclick="openModal('Adil')">A</div>
        <div class="tab tab-h" onclick="openModal('Hanaleï')">H</div>
        <div class="tab tab-p" onclick="openModal('Parents')">P</div>
    </div>

    <div id="detailsModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 id="modalHeader"></h2>
            <div style="display:flex; justify-content:space-between; margin:10px 0;"><span>Payé:</span><b id="modalPaid" style="color:var(--highlight)"></b></div>
            <div style="display:flex; justify-content:space-between; margin:10px 0;"><span>Reste:</span><b id="modalRest" style="color:var(--unpaid)"></b></div>
            <hr style="border:0; border-top:1px solid #444">
            <div style="display:flex; justify-content:space-between; margin:10px 0;"><span>Total:</span><b id="modalTotal"></b></div>
            <button onclick="closeModal()" style="width:100%; padding:12px; margin-top:10px; border-radius:8px; border:none; background:#444; color:white; font-weight:bold;">FERMER</button>
        </div>
    </div>

    <div class="container">
        <h1 style="text-align: center;">Budget Mariage</h1>
        <div id="cardsContainer"></div>
        <button class="btn-save" id="saveButton">ENREGISTRER</button>
        
        <div class="sticky-footer">
            <div class="progress-container"><div id="progressBar"></div></div>
            <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--highlight); margin-bottom: 5px; font-size: 1.2rem;">
                <span>Total Payé</span>
                <span><span id="totalPaid">0</span> €</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #999;">
                <span>Budget : <span id="totalGlobal">0</span> €</span>
                <span>Reste : <span id="totalRemaining">0</span> €</span>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJoAI9wBPbCAgF7wiOZKhS4z2rIvpUTFY",
            authDomain: "budget-mariage-d42dd.firebaseapp.com",
            databaseURL: "https://budget-mariage-d42dd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "budget-mariage-d42dd",
            storageBucket: "budget-mariage-d42dd.firebasestorage.app",
            messagingSenderId: "462100456581",
            appId: "1:462100456581:web:db61911fe3d792b703b5ec"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const budgetRef = ref(db, 'weddingBudget');

        window.stats = { Adil: { paid: 0, total: 0 }, Hanaleï: { paid: 0, total: 0 }, Parents: { paid: 0, total: 0 } };

        const categories = ["Lieu de réception", "Fiançailles Maroc", "Traiteur", "Boissons", "Location sono", "Déco et Activités", "Saxophoniste", "Brunch", "Photographe", "Alliances", "Pièce-Montée", "Robe", "Coiffure et Maquillage", "Costume"];
        const container = document.getElementById('cardsContainer');

        categories.forEach(cat => {
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-category', cat);
            const payeurs = ['adil', 'hanalei', 'parents'].map(p => `
                <div class="payeur-box">
                    <label>${p}</label>
                    <input type="checkbox" class="pay-check" data-field="check_${p}">
                    <input type="number" inputmode="decimal" class="payeur-input" data-field="${p}" placeholder="0">
                </div>`).join('');

            card.innerHTML = `
                <div class="card-title">${cat}</div>
                <div class="total-wrapper">
                    <input type="text" class="input-cout" value="0 €" readonly>
                </div>
                <div class="payeurs-grid">${payeurs}</div>
                <input type="text" class="comment-input" data-field="note" placeholder="Note...">`;
            container.appendChild(card);
        });

        function updateEverything() {
            let globalTotal = 0, globalPaid = 0, sA = 0, pA = 0, sH = 0, pH = 0, sP = 0, pP = 0;

            document.querySelectorAll('.card').forEach(card => {
                const vA = parseFloat(card.querySelector('[data-field="adil"]').value) || 0;
                const vH = parseFloat(card.querySelector('[data-field="hanalei"]').value) || 0;
                const vP = parseFloat(card.querySelector('[data-field="parents"]').value) || 0;
                const cA = card.querySelector('[data-field="check_adil"]').checked;
                const cH = card.querySelector('[data-field="check_hanalei"]').checked;
                const cP = card.querySelector('[data-field="check_parents"]').checked;

                const rowTotal = vA + vH + vP;
                card.querySelector('.input-cout').value = rowTotal > 0 ? rowTotal.toLocaleString() + " €" : "0 €";
                
                globalTotal += rowTotal;
                sA += vA; sH += vH; sP += vP;
                if(cA) pA += vA; if(cH) pH += vH; if(cP) pP += vP;

                card.querySelector('[data-field="adil"]').classList.toggle('is-paid-field', cA);
                card.querySelector('[data-field="hanalei"]').classList.toggle('is-paid-field', cH);
                card.querySelector('[data-field="parents"]').classList.toggle('is-paid-field', cP);
            });

            globalPaid = pA + pH + pP;
            window.stats.Adil = { paid: pA, total: sA };
            window.stats.Hanaleï = { paid: pH, total: sH };
            window.stats.Parents = { paid: pP, total: sP };

            document.getElementById('totalGlobal').innerText = globalTotal.toLocaleString();
            document.getElementById('totalPaid').innerText = globalPaid.toLocaleString();
            document.getElementById('totalRemaining').innerText = (globalTotal - globalPaid).toLocaleString() + " €";
            document.getElementById('progressBar').style.width = (globalTotal > 0 ? (globalPaid / globalTotal) * 100 : 0) + "%";
        }

        window.openModal = function(name) {
            const data = window.stats[name];
            document.getElementById('modalHeader').innerText = name;
            document.getElementById('modalHeader').style.color = name === 'Adil' ? 'var(--adil-color)' : name === 'Hanaleï' ? 'var(--hanalei-color)' : 'var(--parents-color)';
            document.getElementById('modalPaid').innerText = data.paid.toLocaleString() + " €";
            document.getElementById('modalRest').innerText = (data.total - data.paid).toLocaleString() + " €";
            document.getElementById('modalTotal').innerText = data.total.toLocaleString() + " €";
            document.getElementById('detailsModal').classList.add('modal-active');
        };

        window.closeModal = () => document.getElementById('detailsModal').classList.remove('modal-active');

        container.addEventListener('input', updateEverything);
        container.addEventListener('change', (e) => { if(e.target.type === 'checkbox') updateEverything(); });

        onValue(budgetRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.querySelectorAll('.card').forEach(card => {
                    const catName = card.getAttribute('data-category');
                    const savedData = data[catName];
                    if (savedData) {
                        ['adil', 'hanalei', 'parents', 'note'].forEach(f => {
                            const input = card.querySelector(`[data-field="${f}"]`);
                            if(input) input.value = savedData[f] || "";
                        });
                        ['adil', 'hanalei', 'parents'].forEach(p => {
                            const check = card.querySelector(`[data-field="check_${p}"]`);
                            if(check) check.checked = savedData[`check_${p}`] || false;
                        });
                    }
                });
                updateEverything();
            }
        });

        document.getElementById('saveButton').addEventListener('click', function() {
            const btn = this; btn.innerText = "SAUVEGARDE..."; btn.disabled = true;
            let dataToSave = {};
            document.querySelectorAll('.card').forEach(card => {
                const title = card.getAttribute('data-category');
                dataToSave[title] = {
                    adil: card.querySelector('[data-field="adil"]').value || 0,
                    hanalei: card.querySelector('[data-field="hanalei"]').value || 0,
                    parents: card.querySelector('[data-field="parents"]').value || 0,
                    note: card.querySelector('[data-field="note"]').value || "",
                    check_adil: card.querySelector('[data-field="check_adil"]').checked,
                    check_hanalei: card.querySelector('[data-field="check_hanalei"]').checked,
                    check_parents: card.querySelector('[data-field="check_parents"]').checked
                };
            });
            set(budgetRef, dataToSave).then(() => { 
                btn.innerText = "✅ RÉUSSI"; 
                setTimeout(() => { btn.innerText = "ENREGISTRER"; btn.disabled = false; }, 2000); 
            }).catch(e => { alert("Erreur: " + e.message); btn.disabled = false; });
        });
    </script>
</body>
</html>